<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>reproduction-vitepress-vite-unocss-build-forever | Bug Repro</title>
    <meta name="description" content="Vite Build Stuck Forever Bug Repro">
    <link rel="preload stylesheet" href="/assets/style.cb5c9e80.css" as="style">
    
    <script type="module" src="/assets/app.1123db9a.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.caa0fbaf.js">
    <link rel="modulepreload" href="/assets/chunks/theme.6c260cf4.js">
    <link rel="modulepreload" href="/assets/README.md.f25ec65d.lean.js">
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d2ff20f0><!--[--><!--]--><!--[--><span tabindex="-1" data-v-7946b443></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-7946b443> Skip to content </a><!--]--><!----><header class="VPNav" data-v-d2ff20f0 data-v-85af8e60><div class="VPNavBar has-sidebar" data-v-85af8e60 data-v-da260934><div class="container" data-v-da260934><div class="title" data-v-da260934><div class="VPNavBarTitle has-sidebar" data-v-da260934 data-v-d74f6784><a class="title" href="/" data-v-d74f6784><!--[--><!--]--><!----><!--[-->Bug Repro<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-da260934><div class="curtain" data-v-da260934></div><div class="content-body" data-v-da260934><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-da260934><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-da260934 data-v-91a8fbd3><span id="main-nav-aria-label" class="visually-hidden" data-v-91a8fbd3>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-91a8fbd3 data-v-7902e57f><!--[-->Home<!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-da260934 data-v-6aa5e659><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-6aa5e659 data-v-47c68732 data-v-91a7fd09><span class="check" data-v-91a7fd09><span class="icon" data-v-91a7fd09><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-47c68732><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-47c68732><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-da260934 data-v-db5eda06 data-v-aad4a044><!--[--><a class="VPSocialLink no-icon" href="https://github.com/nekomeowww/vitepress-build-forever-bug-repro" aria-label="github" target="_blank" rel="noopener" data-v-aad4a044 data-v-68b7fd2d><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-da260934 data-v-ee8a031f data-v-3bf67bf9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-3bf67bf9><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-3bf67bf9><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-3bf67bf9><div class="VPMenu" data-v-3bf67bf9 data-v-67a28285><!----><!--[--><!--[--><!----><div class="group" data-v-ee8a031f><div class="item appearance" data-v-ee8a031f><p class="label" data-v-ee8a031f>Appearance</p><div class="appearance-action" data-v-ee8a031f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-ee8a031f data-v-47c68732 data-v-91a7fd09><span class="check" data-v-91a7fd09><span class="icon" data-v-91a7fd09><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-47c68732><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-47c68732><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-ee8a031f><div class="item social-links" data-v-ee8a031f><div class="VPSocialLinks social-links-list" data-v-ee8a031f data-v-aad4a044><!--[--><a class="VPSocialLink no-icon" href="https://github.com/nekomeowww/vitepress-build-forever-bug-repro" aria-label="github" target="_blank" rel="noopener" data-v-aad4a044 data-v-68b7fd2d><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-da260934 data-v-8239d48c><span class="container" data-v-8239d48c><span class="top" data-v-8239d48c></span><span class="middle" data-v-8239d48c></span><span class="bottom" data-v-8239d48c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-d2ff20f0 data-v-813dd0fd><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-813dd0fd><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-813dd0fd><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-813dd0fd>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-813dd0fd data-v-32344d2e><button data-v-32344d2e>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-d2ff20f0 data-v-8231e6d8><div class="curtain" data-v-8231e6d8></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-8231e6d8><span class="visually-hidden" id="sidebar-aria-label" data-v-8231e6d8> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-8231e6d8><section class="VPSidebarItem level-0" data-v-8231e6d8 data-v-31c1ab51><div class="item" role="button" tabindex="0" data-v-31c1ab51><div class="indicator" data-v-31c1ab51></div><h2 class="text" data-v-31c1ab51>Bug</h2><!----></div><div class="items" data-v-31c1ab51><!--[--><div class="VPSidebarItem level-1 is-link" data-v-31c1ab51 data-v-31c1ab51><div class="item" data-v-31c1ab51><div class="indicator" data-v-31c1ab51></div><a class="VPLink link link" href="/bug.html" data-v-31c1ab51><!--[--><p class="text" data-v-31c1ab51>Bug</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-d2ff20f0 data-v-4611103f><div class="VPDoc has-sidebar has-aside" data-v-4611103f data-v-f6db5f4f><!--[--><!--]--><div class="container" data-v-f6db5f4f><div class="aside" data-v-f6db5f4f><div class="aside-curtain" data-v-f6db5f4f></div><div class="aside-container" data-v-f6db5f4f><div class="aside-content" data-v-f6db5f4f><div class="VPDocAside" data-v-f6db5f4f data-v-2f77a651><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-2f77a651 data-v-9104446b><div class="content" data-v-9104446b><div class="outline-marker" data-v-9104446b></div><div class="outline-title" data-v-9104446b>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-9104446b><span class="visually-hidden" id="doc-outline-aria-label" data-v-9104446b> Table of Contents for current page </span><ul class="root" data-v-9104446b data-v-7871c622><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-2f77a651></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-f6db5f4f><div class="content-container" data-v-f6db5f4f><!--[--><!--]--><!----><main class="main" data-v-f6db5f4f><div style="position:relative;" class="vp-doc _README" data-v-f6db5f4f><div><h1 id="reproduction-vitepress-vite-unocss-build-forever" tabindex="-1">reproduction-vitepress-vite-unocss-build-forever <a class="header-anchor" href="#reproduction-vitepress-vite-unocss-build-forever" aria-label="Permalink to &quot;reproduction-vitepress-vite-unocss-build-forever&quot;">​</a></h1><p>This is a reproduction repo for a bug I found when using VitePress.</p><p>When the following content appears in Markdown document and try to browse and build with VitePress that configures UnoCSS and Vite:</p><div class="language-markdown"><button title="Copy Code" class="copy"></button><span class="lang">markdown</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#C3E88D;">https://example.com/documentation/</span><span style="color:#89DDFF;">](</span><span style="color:#F07178;text-decoration:underline;">https://example.com/documentation/</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>and the following issues occur:</p><ol><li><p>After executed <code>pnpm docs:dev</code> or (<code>nr docs:dev</code>) command, the development server is running without any complaints and the bugged page is rendered correctly when navigate to, the server hangs and would be stuck once and only when you try to navigate back to the other pages.</p></li><li><p>After executed <code>pnpm docs:dev</code> or (<code>nr docs:dev</code>) command, the building rotating indicator before <code>building client + server bundles...</code> would stop to rotate after a few seconds, and this will eventually result in never ending build process that stuck forever. The shell looks like this:</p></li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">nr</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docs:build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> @ docs:build </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;">/Git/reproduction-vitepress-vite-unocss-build-forever</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> vitepress build</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">vitepress</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">v1.0.0-beta.7</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">⠙</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">building</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">client</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bundles...</span></span></code></pre></div><p>After few minutes, the shell may suddenly prompt <code>[vite:esbuild-transpile] The service was stopped: write EPIPE</code> error even when you have interrupted the build process already.</p><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><ul><li>I tried to check the content above, nor invisible and control characters found.</li><li>Tried to update all the dependencies.</li><li>Tried to disable every plugin I used in Vite, I found that the issue is caused by the <code>unocss</code> plugin only when <code>presetUno()</code> UnoCSS plugin was enabled.</li><li>It looks like the url content must have a valid and resolvable host, otherwise the issue won&#39;t occur. (FYI, the initial url that caused the issue was <code>https://www.swift.org/documentation/</code>)</li></ul><h2 id="further-more" tabindex="-1">Further more <a class="header-anchor" href="#further-more" aria-label="Permalink to &quot;Further more&quot;">​</a></h2><p>Another thing is, I think either Vite or esbuild should have a better way to handle the timeout issue when building forever and deal with the child process to prevent defunct process. Otherwise, if user keep retry and interrupt the build process, the defunct process will keep increasing and cause the system to stay on high load with loads of defunct processes that consume 100% CPU and memory.</p><h3 id="defunct-process-issue" tabindex="-1">defunct process issue <a class="header-anchor" href="#defunct-process-issue" aria-label="Permalink to &quot;defunct process issue&quot;">​</a></h3><p>After executed <code>pnpm docs:build</code> or (<code>nr docs:build</code>) command, the process tree looks like this:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">❯</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pstree</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">09115</span></span>
<span class="line"><span style="color:#A6ACCD;">-</span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">09115</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">neko</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/bin/zsh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-il</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">-</span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">12787</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">neko</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">node</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~/Library/pnpm/global/5/node_modules/@antfu/ni/bin/nr.mjs</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docs:build</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\-+-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">12793</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">neko</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">node</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~/Library/pnpm/global/5/node_modules/@antfu/ni/bin/nr.mjs</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docs:build</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">\-+-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">12817</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">neko</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/opt/homebrew/Cellar/volta/1.1.1_2/libexec/bin/volta</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docs:build</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">     </span><span style="color:#FFCB6B;">\-+-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">12818</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">neko</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">node</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~/.volta/tools/image/packages/pnpm/bin/pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docs:build</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">       </span><span style="color:#FFCB6B;">\-+-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">12837</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">neko</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">node</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~/Git/reproduction-vitepress-vite-unocss-build-forever/node_modules/.bin/../vitepress/bin/vitepress.js</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">         </span><span style="color:#FFCB6B;">\---</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">12843</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">neko</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~/Git/reproduction-vitepress-vite-unocss-build-forever/node_modules/.pnpm/@esbuild+darwin-arm64@0.18.18/node_modules/@esbuild/darwin-arm64/bin/esbuild</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--service=0.18.18</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--ping</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\--</span><span style="color:#A6ACCD;">= </span><span style="color:#F78C6C;">09722</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">neko</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/bin/zsh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-il</span></span></code></pre></div><p>If you inspect the CPU and memory usage, you will find the node process pid <code>12837</code> is consuming 100% CPU:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">❯</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ps</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">16897</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">%cpu,%mem</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">%CPU</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">%MEM</span></span>
<span class="line"><span style="color:#FFCB6B;">100.0</span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">1.8</span></span></code></pre></div><p>Then use Ctrl-C to interrupt the build process, and the process tree for the same zsh shell pid <code>09115</code> looks like this afterwards:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">❯</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pstree</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">09115</span></span>
<span class="line"><span style="color:#A6ACCD;">-</span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">09115</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">neko</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/bin/zsh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-il</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\--</span><span style="color:#A6ACCD;">= </span><span style="color:#F78C6C;">09722</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">neko</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/bin/zsh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-il</span></span></code></pre></div><p>You may notice this process tree is now empty, but the process tree for the VitePress build process pid <code>12837</code> is still there with a defunct child process:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">❯</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pstree</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">12837</span></span>
<span class="line"><span style="color:#FFCB6B;">-+-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">12837</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">neko</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">node</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~/Git/reproduction-vitepress-vite-unocss-build-forever/node_modules/.bin/../vitepress/bin/vitepress.js</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\---</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">12843</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">neko</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">defunc</span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-f6db5f4f data-v-b83c2840><!--[--><!--]--><!----><nav class="prev-next" data-v-b83c2840><div class="pager" data-v-b83c2840><!----></div><div class="pager" data-v-b83c2840><a class="pager-link next" href="/bug.html" data-v-b83c2840><span class="desc" data-v-b83c2840>Next page</span><span class="title" data-v-b83c2840>Bug</span></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"bug.md\":\"31b37bec\",\"index.md\":\"4a2993d8\",\"readme.md\":\"f25ec65d\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Bug Repro\",\"description\":\"Vite Build Stuck Forever Bug Repro\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"}],\"sidebar\":[{\"text\":\"Bug\",\"items\":[{\"text\":\"Bug\",\"link\":\"/bug\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/nekomeowww/vitepress-build-forever-bug-repro\"}]},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>